accelerator:
  displayName: Web backend microservice with Spring Boot
  description: Accelerator to create a web backend microservice with Spring Boot
  iconUrl: https://raw.githubusercontent.com/simple-starters/icons/master/icon-boot.png
  tags:
  - cloud-native-devs
  - spring
  - dekt-demo

  options:
  
  #- name: addAlv
  #  label: Add application live view
  #  description: Add application live view sidecar to your deployment config
  #  inputType: checkbox 
  #  defaultValue: false
  #  dataType: boolean
  #  dependsOn:
  #    name: appDeploymentType
  #    value: k8s
        
#  - name: gitRepo
#    label: Source repository
#    description: Name of your git repo (not the full URL)
#    inputType: text
#    dataType: string
#    defaultValue: my-backend
  
  - name: parentApp
    label: Name of parent application (the Big A app)
    #description: Name of the parent application this component is a part of
    inputType: text
    dataType: string
    defaultValue: devx-mood
    
  - name: javaVersion
    label: Java version
    #description: Java runtime version
    required: true
    defaultValue: "11"
    inputType: select
    choices:
      - value: "11"
        text: 11 
      - value: "17"
        text: 17 (dev only)
  
  #data services
  - name: addDB
    label: Request a SQL database 
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name: dbType
    label: Available SQL service claims
    dependsOn:
      name: addDB
    inputType: select
    defaultValue: postgres
    choices:
      - value: postgres
        text: Postgres
      - value: mariadb
        text: MariaDB
  - name: dbName
    label: Name your SQL claim
    defaultValue: inventory
    dependsOn:
      name: addDB
      
  - name: addMsg
    label: Request a Messaging Queue  
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  - name: msgType
    label: Available Messaging service claims
    dependsOn:
      name: addMsg
    inputType: select
    defaultValue: rabbitmq
    choices:
      - value: rabbitmq
        text: Rabbitmq
      - value: kafka
        text: Kafka
  - name: msgName
    label: Name your Messaging claim
    defaultValue: reading
    dependsOn:
      name: addMsg
      
  - name: addNosql
    label: Request a NoSQL datastore   
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
    
  - name: nosqlType
    label: Available NoSQL service-claims
    dependsOn:
      name: addNosql
    inputType: select
    defaultValue: redis
    choices:
      - value: redis
        text: Redis
      - value: cassandra 
        text: Cassandra
  - name: nosqlName
    label: Name your NoSQL claim
    defaultValue: mynosql
    dependsOn:
      name: addNosql
 
  #apis 
  - name: newAPIs
    label: Expose new APIs
    description: USE THE TAP API CATALOG TO EXPLORE EXISTING APIs BEFORE EXPOSING NEW ONES
    inputType: checkbox 
    defaultValue: false
    display: true
    dataType: boolean
  - name: apiType
    label: API type
    dependsOn:
      name: newAPIs
    inputType: select
    defaultValue: openAPI
    choices:
      - value: openAPI
        text: Open API
      - value: swagger
        text: Swagger
      - value: gRPC
        text: gRPC
  - name: apiPath
    label: API definitions path
    dependsOn:
      name: newAPIs
    defaultValue: /api-docs/mood-sensors-apis.yaml
  - name: apiOwner
    label: API owner
    dependsOn:
      name: newAPIs
    defaultValue: dekt-dev-team2
  - name: apiMetaData
    label: APIs metadata 
    description: Select which APIs metatdata decorations to add to the api definition file
    dependsOn:
      name: newAPIs
    inputType: checkbox
    dataType: [string]
    choices:
    - value: readOnly
      text: Read only APIs
    - value: readWrite
      text: Read and write APIs
    - value: schema
      text: Schema and error respones
    - value: rateLimit
      text: Rate limits filter 
    - value: sso
      text: SSO and token relay filters
  - name: apiAutoRegistration
    label: Add API auto registration
    inputType: checkbox
    dependsOn:
      name: newAPIs
      value: true
    dataType: boolean
    defaultValue: false

#appSSO
  - name: appSSO
    label: Add security configurations 
    defaultValue: false
    inputType: checkbox
    dataType: boolean
    required: true
  - name: appSSOName
    label: AppSSO instance name
    defaultValue: appsso-mood-sensors
    inputType: text
    dataType: string
    required: true
    dependsOn: 
      name: appSSO
  - name: appSSOIssuerURI
    label: Issuer URI of the AppSSO Instance
    defaultValue: http://authserver.<domainname>
    inputType: text
    dataType: string
    required: true
    dependsOn: 
      name: appSSO
  - label: Redirect URI after successful authentication
    defaultValue: http://mood-sensors.<domain name>/login/oauth2/code/sso
    name: appSSORedirectURI
    inputType: text
    dataType: string
    required: true
    dependsOn: 
      name: appSSO
      
 #deployment type
  - name: appDeploymentType
    label: Deployment environment
    #description: Type of deployment configurations
    defaultValue: tap
    inputType: select
    choices:
    - value: tap
      text: Tanzu App Platform workload
    - value: k8s
      text: K8s deployment with Skaffold configs
    - value: cf
      text: Tanzu App Service manifest
      
engine:
  merge:
    #generic transformation
    - includes: ["**"]
      excludes: [ "config/**" , "src/main/java/backend/connectors/**"]
      chain:
        - type: ReplaceText
          substitutions:
            - text: APP_NAME
              with: "#artifactId"
            - text: JAVA_VER
              with: "#javaVersion"
            - text: PARENT_APP
              with: "#parentApp"
  
  #deployment configs per type
    - includes: [ "config/tap/**"]
      condition: "#appDeploymentType == 'tap'"
      chain:
        - type: YTT
    - includes: [ "config/cf/**"]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: YTT
    - includes: [ "config/k8s/**"]
      condition: "#appDeploymentType == 'k8s'"
      chain:
        - type: YTT
    - includes: [ "config/cf/manifest.yaml"]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: YTT
    #- includes: [ "config/cf/*.json" ]
    #  condition: "#appDeploymentType == 'cf'"
    #  chain:
    #    - type: ReplaceText
    #      substitutions:
    #      - text: app-name
    #        with: "#artifactId"
    #      - text: api-group1
    #        with: "#firstApiGroup"
    #      - text: api-group2
    #        with: "#secondApiGroup"
    
    #data entity transformations
    - includes: [ "src/main/java/backend/connectors/RabbitMQTemplate.java" ]
      condition: "#msgType == 'rabbitmq'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#msgName"
    - includes: [ "src/main/java/backend/connectors/RedisTemplate.java" ]
      condition: "#cacheType == 'redis'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#cacheName"
    - includes: [ "src/main/java/backend/connectors/PostgresTemplate.java" ]
      condition: "#dbType == 'postgres'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#dbName" 
  
    
