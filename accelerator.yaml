accelerator:
  displayName: Web backend microservice with Spring Boot
  description: Accelerator to create a web backend microservice with Spring Boot
  iconUrl: https://raw.githubusercontent.com/simple-starters/icons/master/icon-boot.png
  tags:
  - cloud-native-devs
  - spring
  - dekt-demo

  options:
  
  #- name: addAlv
  #  label: Add application live view
  #  description: Add application live view sidecar to your deployment config
  #  inputType: checkbox 
  #  defaultValue: false
  #  dataType: boolean
  #  dependsOn:
  #    name: appDeploymentType
  #    value: k8s
        
#  - name: gitRepo
#    label: Source repository
#    description: Name of your git repo (not the full URL)
#    inputType: text
#    dataType: string
#    defaultValue: my-backend
  
  - name: parentApp
    label: Name of parent application (the Big A app)
    #description: Name of the parent application this component is a part of
    inputType: text
    dataType: string
    defaultValue: devx-mood
    
  - name: javaVersion
    label: Java version
    #description: Java runtime version
    required: true
    defaultValue: "11"
    inputType: select
    choices:
      - value: "11"
        text: 11 
      - value: "17"
        text: 17 (dev only)
  
  #data services
  - name: addDB
    label: Request a SQL database
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name: dbType
    label: SQL Database type
    dependsOn:
      name: addDB
    inputType: select
    defaultValue: postgres
    choices:
      - value: postgres
        text: Postgres
      - value: mariadb
        text: MariaDB
  - name: dbName
    label: SQL Database instance name
    defaultValue: inventory
    dependsOn:
      name: addDB
      
  - name: addMsg
    label: Request a messaging broker  
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  - name: msgType
    label: Messaging broker type
    dependsOn:
      name: addMsg
    inputType: select
    defaultValue: rabbitmq
    choices:
      - value: rabbitmq
        text: Rabbitmq
      - value: kafka
        text: Kafka
  - name: msgName
    label: Messaging broker instance name
    defaultValue: reading
    dependsOn:
      name: addMsg
      
  - name: addNosql
    label: Request a NoSQL datastore   
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
    
  - name: nosqlType
    label: NoSQL datastore type
    dependsOn:
      name: addNosql
    inputType: select
    defaultValue: redis
    choices:
      - value: redis
        text: Redis
      - value: cassandra 
        text: Cassandra
  - name: nosqlName
    label: NoSQL datastore instance name
    defaultValue: mynosql
    dependsOn:
      name: addNosql
 
  #apis 
  - name: newAPIs
    label: Add APIs definitions. Explore existing APIs *before* adding new ones
    #description: 
    inputType: checkbox 
    defaultValue: false
    display: true
    dataType: boolean
      
  - name: readAPIs
    label: APIs with READ-ONLY functionality 
    #description: APIs decorations are auto-generated based on DEKT org security guidelines.
    dependsOn:
      name: newAPIs
      value: true
    inputType: multi-text
    required: false
    dataType: [string]
    defaultValue:
      - measure
  
  - name: writeAPIs
    label: APIs with WRITE/DELETE functionality
    #description: APIs decorations are auto-generated based on DEKT org security guidelines.
    dependsOn:
      name: newAPIs
      value: true
    inputType: multi-text
    required: false
    dataType: [string]
    defaultValue:
      - activate
      
 #deployment type
  - name: appDeploymentType
    label: Deployment environment
    #description: Type of deployment configurations
    defaultValue: tap
    inputType: select
    choices:
    - value: tap
      text: Tanzu App Platform workload
    - value: k8s
      text: K8s deployment with Skaffold configs
    - value: cf
      text: Tanzu App Service manifest
      
engine:
  merge:
    #generic transformation
    - includes: ["**"]
      excludes: [ "config/**" , "src/main/java/backend/connectors/**"]
      chain:
        - type: ReplaceText
          substitutions:
            - text: APP_NAME
              with: "#artifactId"
            - text: JAVA_VER
              with: "#javaVersion"
            - text: PARENT_APP
              with: "#parentApp"
  
  #deployment configs per type
    - includes: [ "config/tap/**"]
      condition: "#appDeploymentType == 'tap'"
      chain:
        - type: YTT
    - includes: [ "config/cf/**"]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: YTT
    - includes: [ "config/k8s/**"]
      condition: "#appDeploymentType == 'k8s'"
      chain:
        - type: YTT
    - includes: [ "config/cf/manifest.yaml"]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: YTT
    #- includes: [ "config/cf/*.json" ]
    #  condition: "#appDeploymentType == 'cf'"
    #  chain:
    #    - type: ReplaceText
    #      substitutions:
    #      - text: app-name
    #        with: "#artifactId"
    #      - text: api-group1
    #        with: "#firstApiGroup"
    #      - text: api-group2
    #        with: "#secondApiGroup"
    
    #data entity transformations
    - includes: [ "src/main/java/backend/connectors/RabbitMQTemplate.java" ]
      condition: "#msgType == 'rabbitmq'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#msgName"
    - includes: [ "src/main/java/backend/connectors/RedisTemplate.java" ]
      condition: "#cacheType == 'redis'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#cacheName"
    - includes: [ "src/main/java/backend/connectors/PostgresTemplate.java" ]
      condition: "#dbType == 'postgres'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#dbName" 
  
    
