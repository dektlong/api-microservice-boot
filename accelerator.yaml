accelerator:
  displayName: API-driven backend with Spring Boot
  description: Accelerator to create Backend API service using Spring Boot
  iconUrl: https://raw.githubusercontent.com/simple-starters/icons/master/icon-boot.png
  tags:
  - cloud-native-devs
  - spring
  - dekt-demo

  options:
  
  #- name: addAlv
  #  label: Add application live view
  #  description: Add application live view sidecar to your deployment config
  #  inputType: checkbox 
  #  defaultValue: false
  #  dataType: boolean
  #  dependsOn:
  #    name: appDeploymentType
  #    value: k8s
        
#  - name: gitRepo
#    label: Source repository
#    description: Name of your git repo (not the full URL)
#    inputType: text
#    dataType: string
#    defaultValue: my-backend
  
  - name: parentApp
    label: Name of parent application (the Big A app)
    description: Name of the parent application this component is a part of
    inputType: text
    dataType: string
    defaultValue: my-BigA-app
    
  - name: javaVersion
    label: Java version
    description: Java runtime version
    required: true
    defaultValue: "11"
    inputType: select
    choices:
      - value: "11"
        text: 11 
      - value: "17"
        text: 17 (dev only)
  
  #data services
  - name: addDB
    label: Request a database service
    description: Add a service request to a database
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name: dbType
    label: Database service type
    dependsOn:
      name: addDB
    description: Select the database service type
    inputType: select
    defaultValue: PostgresCluster
    choices:
      - value: PostgresCluster
        text: PostgreSQL (K8s service)
      - value: MySQLVM
        text: MySQL (Dedicated VM)
      - value: RDSPostgresSQL
        text: Amazon RDS PostgresSQL
  - name: dbName
    label: Database service name
    description: Database service name
    defaultValue: mydb
    dependsOn:
      name: addDataServices
      
  - name: addMsg
    label: Requst a messaging service 
    description: Add a service request to a message queue
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  - name: msgType
    label: Streaming service type
    description: Select the streaming service type
    dependsOn:
      name: addMsg
    inputType: select
    defaultValue: RabbitMQCluster
    choices:
      - value: RabbitMQCluster
        text: RabbitMQ (K8s service)
      - value: KafkaVM
        text: Kafka (Dedicated VM)
      - value: AzureServiceBusConnector
        text: Azure Service Bus
  - name: msgName
    label: Messaging service name
    description: Message service name
    defaultValue: myqueue
    dependsOn:
      name: addMsg
      
  - name: addCache
    label: Request a caching service 
    description: Add a service request to a caching service
    inputType: checkbox
    display: true
    dataType: boolean
    defaultValue: false
  
  - name: cacheType
    label: Caching service type
    description: Select the cachingservice type
    dependsOn:
      name: addCache
    inputType: select
    defaultValue: RedisCluster
    choices:
      - value: RedisCluster
        text: Redis
      - value: ElastiCacheConnector
        text: Amazon ElastiCache
  - name: cacheName
    label: Caching service name
    description: Caching service name
    defaultValue: mycache
    dependsOn:
      name: addCache
 
  #apis 
  - name: newAPIs
    label: Add APIs definitions. Use the API Explorer plugin to re-use existing APIs.
    description: 
    inputType: checkbox 
    defaultValue: false
    display: true
    dataType: boolean
      
  - name: readAPIs
    label: APIs with READ-ONLY functionality 
    description: APIs decorations are auto-generated based on DEKT org security guidelines.
    dependsOn:
      name: newAPIs
      value: true
    inputType: multi-text
    required: false
    dataType: [string]
  
  - name: writeAPIs
    label: APIs with WRITE/DELETE functionality
    description: APIs decorations are auto-generated based on DEKT org security guidelines.
    dependsOn:
      name: newAPIs
      value: true
    inputType: multi-text
    required: false
    dataType: [string]

 #deployment type (for demo vision paiting)
  - name: appDeploymentType
    label: Deployment environment
    description: Type of deployment configurations
    defaultValue: tap
    inputType: select
    choices:
    - value: tap
      text: Tanzu App Platform workload
    - value: k8s
      text: K8s deployment with Skaffold configs
    - value: cf
      text: Tanzu App Service manifest
      
engine:
  merge:
    #generic transformation
    - includes: ["**"]
      excludes: [ "config/**", "src/main/java/io/storebackend/api/data/*" ]
      chain:
        - type: ReplaceText
          substitutions:
            - text: app-name
              with: "#artifactId"
  
  #deployment configs per type
    - includes: [ "config/tap/**"]
      condition: "#appDeploymentType == 'tap'"
      chain:
        - type: YTT
    - includes: [ "config/cf/**"]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: YTT
    - includes: [ "config/k8s/**"]
      condition: "#appDeploymentType == 'k8s'"
      chain:
        - type: YTT
    - includes: [ "config/cf/manifest.yaml"]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: YTT
    - includes: [ "config/cf/*.json" ]
      condition: "#appDeploymentType == 'cf'"
      chain:
        - type: ReplaceText
          substitutions:
          - text: app-name
            with: "#artifactId"
          - text: api-group1
            with: "#firstApiGroup"
          - text: api-group2
            with: "#secondApiGroup"
    
    #data entity transformations
    - includes: [ "src/main/java/io/storebackend/api/data/RabbitMQTemplate.java" ]
      condition: "#msgType == 'RabbitMQCluster'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#msgName"
    - includes: [ "src/main/java/io/storebackend/api/data/RedisTemplate.java" ]
      condition: "#cacheType == 'Redisluster'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#cacheName"
    - includes: [ "src/main/java/io/storebackend/api/data/PostgresTemplate.java" ]
      condition: "#dbType == 'PostgresCluster'"
      chain:
        - type: ReplaceText
          substitutions:
            - text: mybean
              with: "#dbName" 
  
    
